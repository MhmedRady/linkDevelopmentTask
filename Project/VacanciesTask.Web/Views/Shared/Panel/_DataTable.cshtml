
@using VacanciesTask.Shared.Helpers
@using Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = "Layout/_CardView";
}

@section Styles {
        <link rel="stylesheet" type="text/css" href="~/admin/app-assets/vendors/css/tables/datatable/datatables.min.css">
        <link rel="stylesheet" type="text/css" href="~/admin/app-assets/vendors/css/extensions/sweetalert.css">
}
@if (ViewBag.CreateBtn is true)
{
    <a class="CreateBtn btn btn-info text-capitalize white my-2" asp-action="Create" style="font-size: 1.2rem;">
        <i class="ft-file-plus" style="font-size: 1.5rem;"></i>
        @ViewData["add_new"]
    </a>
}

<table class="table data-table table-striped table-bordered zero-configuration text-center">
    <thead>
        <tr>
            <th>#</th>
            @foreach (var col in ViewBag.Columns)
            {
                <th>@col</th>
            }
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    <tr>
        <td colspan="7"><span class="text-capitalize fw-bold">No Date </span></td>
    </tr>
    </tbody>
</table>


@section Scripts {
    <script src="~/admin/app-assets/vendors/js/tables/datatable/datatables.min.js" type="text/javascript"></script>
    <script src="~/admin/app-assets/vendors/js/tables/datatable/dataTables.buttons.min.js" type="text/javascript"></script>
    <script src="~/admin/app-assets/vendors/js/tables/datatable/dataTables.responsive.min.js" type="text/javascript"></script>
    <script src="~/admin/app-assets/vendors/js/extensions/sweetalert.min.js" type="text/javascript"></script>
    <script>
            $(document).ready(function () {

                let localPath = location.pathname.replace('/', '');
                
                let table = $(".data-table").DataTable({ 
                    "processing": true,        
                    "serverSide": true,
                    "filter": true,
                    "orderMulti": false, 
                    "pageLength": 10,
                    "paging": true,
                    "ajax": {
                        "url": "@ViewData["url"]",
                        "type": "POST",
                        "datatype": "json"
                    },
                    "columns": [
                        {
                            "name": "#",
                            "autoWidth": true,
                            "title": "#",
                            "render": function (data, type, full, meta) {
                                return (meta.settings._iDisplayLength * table.page.info().page) + meta.row + 1
                            }
                        }
                        @foreach (var col in ViewBag.Columns)
                        {
                            <text>{ "data": "@Helper.LowerFirstLetter(col)"||"-", "name": "@col", "autoWidth": true, "orderable": false }</text>
                        }
                        {
                            name: "actions",
                            "autoWidth": false,
                            orderable: false,
                            "render": function (data, type, full, meta) {
                                let html = '<div class="row justify-content-center">';
                                html += ` <a href="@Url.Action("Edit")?id=${full.id}" class="btn btn-info white mb-1 mx-50" data-toggle="tooltip" data-placement="top" title="edit"><i class="ft-edit"></i></a>`;
                                html += `<button class="active btn btn-warning white mb-1 mx-50" data-toggle="tooltip" data-placement="top" title="isActive" data-guid="${full.id}"><i class="ft-repeat"></i></button>`
                                html += `<button type="button" class="confirm-delete btn btn-danger white mb-1 mx-50" data-guid="${full.id}" title="delete"><i class="ft-trash-2"></i></button>`;
                                html+= `</div>`;
    
                                //html += `<a onclick="return confirm('Are you sure you want to delete IBooking Content?')" href="${localPath}/Delete?id=${full.id}" class="btn btn-danger white mx-50" data-toggle="tooltip" data-placement="top" title="@localizer["delete"]"><i class="ft-trash-2"></i></a>`;
                                return html;
                            }
                        },
            ]

        });
                
        $(document).on('click', '.confirm-delete' , function () {
            let guid = $(this).data("guid");
            console.log(guid)
            swal({
                title: `Delete @ViewContext.RouteData.Values["controller"].ToString().ToLower() ?!`,
                text: "@ViewData["deleteText"]",
                icon: "warning",
                showCancelButton: true,
                buttons: {
                    cancel: {
                        text: "No Cancel",
                        value: null,
                        visible: true,
                        className: "btn-warning",
                        closeModal: false,
                    },
                    confirm: {
                        text: "Yes Delete",
                        value: true,
                        visible: true,
                        className: "btn-danger",
                        closeModal: false
                    }
                }
            }).then(isConfirm => {
                if (isConfirm) {
                    $.ajax({
                        method: "DELETE",
                        url: `@Url.Action("Delete")?id=${guid}`,
                        success: function(data){
                            console.log(data);
                            console.log(data.status);
                            if (data.status == 202) {
                                swal("@localizer["deleted"]!", data.msg, "success");
                                table.ajax.reload();
                            }else if(data.status == 404){
                                swal("@localizer["not found"]!", responseText.msg, "error");
                            }else{
                                swal("@localizer["Cancelled"]", data.msg, "error");
                            }
                        }
                    });
                } else {
                    swal("@localizer["Cancelled"]", `@localizer["DataNotDeleted"]`, "warning");
                }
            });
        });
    });
    
    </script>
}
